"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5140],{7390:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>m,frontMatter:()=>i,metadata:()=>a,toc:()=>d});var r=s(4848),o=s(8453);const i={id:"custom-commands",sidebar_label:"Custom Commands",title:"Garnet Custom Commands"},t=void 0,a={id:"dev/custom-commands",title:"Garnet Custom Commands",description:"Overview",source:"@site/docs/dev/custom-commands.md",sourceDirName:"dev",slug:"/dev/custom-commands",permalink:"/garnet/docs/dev/custom-commands",draft:!1,unlisted:!1,editUrl:"https://github.com/microsoft/garnet/tree/main/website/docs/dev/custom-commands.md",tags:[],version:"current",frontMatter:{id:"custom-commands",sidebar_label:"Custom Commands",title:"Garnet Custom Commands"},sidebar:"garnetDocSidebar",previous:{title:"Transactions",permalink:"/garnet/docs/dev/transactions"},next:{title:"Cluster Mode",permalink:"/garnet/docs/dev/cluster"}},c={},d=[{value:"Overview",id:"overview",level:2},{value:"Supported Custom Command Types",id:"supported-custom-command-types",level:2},{value:"Server-Side Command Registration",id:"server-side-command-registration",level:2},{value:"Client-Side Command Registration",id:"client-side-command-registration",level:2},{value:"Enabling Client-Side Command Registration",id:"enabling-client-side-command-registration",level:3},{value:"REGISTER Command",id:"register-command",level:3},{value:"Full command syntax:",id:"full-command-syntax",level:4},{value:"New command sub-command syntax:",id:"new-command-sub-command-syntax",level:4},{value:"RESP Reply",id:"resp-reply",level:3},{value:"REGISTER Errors",id:"register-errors",level:3}];function l(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Garnet supports registering custom commands and transactions implemented in C#, both programmatically on the server-side and through running dedicated REGISTER command in the client-side."}),"\n",(0,r.jsx)(n.h2,{id:"supported-custom-command-types",children:"Supported Custom Command Types"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Raw String Commands"}),": To implement a custom raw string command, implement a class that inherits from the ",(0,r.jsx)(n.code,{children:"CustomRawStringFunctions"})," base class (See example: ",(0,r.jsx)(n.code,{children:"GarnetServer\\DeleteIfMatch.cs"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Object Commands"}),": To implement a custom object command, implement your custom object class that inherits from ",(0,r.jsx)(n.code,{children:"GarnetObjectBase"})," base class, as well as a factory that creates your object type that inherits from the ",(0,r.jsx)(n.code,{children:"CustomObjectFactory"})," base class (See example: ",(0,r.jsx)(n.code,{children:"GarnetServer\\MyDictObject.cs"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Transaction"}),": To implement a custom transaction, implement a class that inherits from the ",(0,r.jsx)(n.code,{children:"CustomTransactionProcedure"})," base class (See example: ",(0,r.jsx)(n.code,{children:"GarnetServer\\Procedures\\ReadWriteTxn.cs"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"server-side-command-registration",children:"Server-Side Command Registration"}),"\n",(0,r.jsxs)(n.p,{children:["To register a new custom command from the server-side, use the GarnetServer instance's RegisterApi, and call either ",(0,r.jsx)(n.code,{children:"NewCommand"})," or ",(0,r.jsx)(n.code,{children:"NewTransactionProc"})," according to the custom command type that you are trying to register."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Raw String Commands"}),": To register a new command using a concrete class implementing ",(0,r.jsx)(n.code,{children:"CustomRawStringFunctions"}),", call ",(0,r.jsx)(n.code,{children:"RegisterApi.NewCommand(string name, int numParams, CommandType type, CustomRawStringFunctions customFunctions, long expirationTicks = 0)"}),", where ",(0,r.jsx)(n.code,{children:"customFunctions"})," is an instance of the new concrete class."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Object Commands"}),": To register a new command using a concrete class implementing ",(0,r.jsx)(n.code,{children:"CustomObjectFactory"}),", call ",(0,r.jsx)(n.code,{children:"RegisterApi.NewCommand(string name, int numParams, CommandType commandType, CustomObjectFactory factory)"}),", where ",(0,r.jsx)(n.code,{children:"factory"})," is an instance of the new concrete class."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom Transaction"}),": To register a new transaction using a concrete class implementing ",(0,r.jsx)(n.code,{children:"CustomTransactionProcedure"}),", call ",(0,r.jsx)(n.code,{children:"NewTransactionProc(string name, int numParams, Func<CustomTransactionProcedure> proc)"}),", where ",(0,r.jsx)(n.code,{children:"proc"})," is a ",(0,r.jsx)(n.code,{children:"Func"})," that returns an instance of the new concrete class."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"client-side-command-registration",children:"Client-Side Command Registration"}),"\n",(0,r.jsxs)(n.p,{children:["To register a new custom command from the client-side, use the dedicated REGISTER command in the client app (",(0,r.jsx)(n.strong,{children:"note:"})," this is an ",(0,r.jsx)(n.strong,{children:"admin command"}),"). ",(0,r.jsx)("br",{}),"\nThe REGISTER command takes assemblies that exist on the server and contain implementations for either of the supported custom command classes, and registers the custom commands on the server according to parameters given by the client ",(0,r.jsx)("br",{}),"\nThe REGISTER command supports registering multiple commands and / or transactions from multiple files and / or directories containing C# binary files (*.dll / *.exe).",(0,r.jsx)("br",{})]}),"\n",(0,r.jsx)(n.h3,{id:"enabling-client-side-command-registration",children:"Enabling Client-Side Command Registration"}),"\n",(0,r.jsxs)(n.p,{children:["To enable registering client-side custom commands, you must specify a list of allowed paths from which assemblies can potentially be loaded. This is done by setting the configuration parameter ",(0,r.jsx)(n.code,{children:"ExtensionBinPaths"}),".\nExample (in garnet.config):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'"ExtensionBinPaths": ".\\first\\path\\,..\\..\\second\\path\\"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note #1"}),": Assemblies can be loaded from any directory level under these specified paths",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.strong,{children:"Note #2"}),": By default, Garnet only allows loading of digitally signed assemblies. To remove that requirement (not recommended), set the configuration parameter ",(0,r.jsx)(n.code,{children:"ExtensionAllowOnlySignedAssemblies"})," to ",(0,r.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"register-command",children:"REGISTER Command"}),"\n",(0,r.jsxs)(n.p,{children:["To run the REGISTER command, run the REGISTER keyword followed by one or more new command subcommands, followed by the SRC keyword, which is followed by one or more paths to C# binary files or directories containing C# binary files (*.dll / *.exe).",(0,r.jsx)("br",{})]}),"\n",(0,r.jsx)(n.h4,{id:"full-command-syntax",children:"Full command syntax:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"REGISTER cmdType name numParams className [expTicks] [cmdType name numParams className [expTicks] ...] SRC path [path ...]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Each new command that you intend to register, is specified by either of the command type keywords, followed by its parameters."}),"\n",(0,r.jsx)(n.h4,{id:"new-command-sub-command-syntax",children:"New command sub-command syntax:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"cmdType name numParams cmdType className [expTicks]\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Command Type:"}),(0,r.jsx)("br",{}),"\nThe following keywords are legal values for ",(0,r.jsx)(n.code,{children:"cmdType"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"READ"})," (New read command)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"READMODIFYWRITE"})," or ",(0,r.jsx)(n.strong,{children:"RMW"})," (New Read-modify-write command)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TRANSACTION"})," or ",(0,r.jsx)(n.strong,{children:"TXN"})," (New transaction)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"name"}),": Name of the new command"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"numParams"}),": Number of parameters taken by the new command"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"className"}),": Class name of concrete class implementing ",(0,r.jsx)(n.code,{children:"CustomRawStringFunctions"})," or ",(0,r.jsx)(n.code,{children:"CustomObjectFactory"})," for new ",(0,r.jsx)(n.strong,{children:"READ"})," / ",(0,r.jsx)(n.strong,{children:"RMW"})," commands, or ",(0,r.jsx)(n.code,{children:"CustomTransactionProcedure"})," for new ",(0,r.jsx)(n.strong,{children:"TXN"})," commands (must exist in assemblies referenced in paths list)",(0,r.jsx)("br",{})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"expTicks"}),": Command expiry in ticks (only relevant for custom raw string commands, ignored otherwise)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"-1"}),": remove existing expiration metadata;"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"0"}),": retain whatever it is currently (or no expiration if this is a new entry) - this is the default;"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:">0"}),": => set expiration to given value."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," If the server could not register one or more of the commands / transactions specified, or if it could not load or enumerate one or more of the files or directories specified in the REGISTER command, no action will be taken (i.e. no command will be registered), and the command execution will fail with an appropriate error message."]}),"\n",(0,r.jsx)(n.h3,{id:"resp-reply",children:"RESP Reply"}),"\n",(0,r.jsx)(n.p,{children:"Returns +OK on success, otherwise --ERR message if any"}),"\n",(0,r.jsx)(n.h3,{id:"register-errors",children:"REGISTER Errors"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR malformed REGISTER command"})," - Error in the parsing of the REGISTER command"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR unable to access one or more binary files"})," - Error accessing or enumerating one or more files or folders specified in path list"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR one or more binary file are not contained in allowed paths"})," - One or more of the binary paths specified are not contained in the allowed path list according to the server configuration (",(0,r.jsx)(n.code,{children:"ExtensionBinPaths"})," in garnet.config)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR unable to load one or more assemblies"})," - Error loading one or more assemblies from binary files retrieved from path list (assembly load is attempted on all *.dll / *.exe files specified or found in directories specified)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR one or more assemblies loaded is not digitally signed"})," - One or more of the loaded assemblies are not digitally signed. This error will occur when trying to load unsigned assemblies when the server configuration is set to allow loading of only digitally signed assemblies (",(0,r.jsx)(n.code,{children:"ExtensionAllowOnlySignedAssemblies"})," in garnet.conf)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR unable to instantiate one or more classes from given assemblies"})," - Error creating an instance of one or more classes specified using loaded assemblies (note that each class should have an empty constructor)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ERR unable to register one or more unsupported classes"})," - Error registering one or more unsupported classes, i.e. one or more of the classes were not implementing one of the expected base classes"]}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var r=s(6540);const o={},i=r.createContext(o);function t(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);